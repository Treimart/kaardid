<!DOCTYPE html>
<html>
    <head>
        <title>Kaart</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" />
        <style>
            body {padding: 0; margin: 0; }
            html, body { height: 100%; width: 100%;}
            #kaardikiht {float:bottom; width:100%; height: 100%;}
            #pealkiri {position: fixed; top: 0; right: 0; z-index: 2;}
        </style>
        <script>
            var kaart, abikiht;
            var hypik;

            function algus(){
                kaart = L.map('kaardikiht').setView([59.441059, 24.595989], 15);
                new L.TileLayer(
                    'https://tiles.maaamet.ee/tm/tms/1.0.0/hybriid@GMC/{z}/{x}/{y}.png&ASUTUS=TLU&ERIALA=DIGIHUMANITAARIA',
                    {
                        attribution: "Map: <a  href='http://www.maaamet.ee/'>Maa-amet</a>",
                        tms: true,
                    }
                ).addTo(kaart);

                abikiht=L.layerGroup()
                abikiht.addTo(kaart);
                hypik=L.popup(); 
                kaart.on("click", vajutus);
                loe();
            }

            function loe() {
                fetch(
                    "https://script.google.com/macros/s/AKfycbzkTI10bu1ixAovHR4P7GvJVJ8nkOdMbM3-VVIHE0IMCdEqLaut7F2DIXgqZ3tLdlW0qg/exec"
                ).then(d => d.json()).then(kuva);
            }

            function kuva(d) {
                console.log(d);
                abikiht.clearLayers();
                for(rida of d.slice(1)) {
                    let marker = L.marker([parseFloat(rida[1]), parseFloat(rida[2])], {title: rida[0]});
                    marker.addTo(abikiht);
                }
            }

            function vajutus(e) {
                let pealkiri = document.getElementById("pealkiri").value;
                hypik.setLatLng(e.latlng).
                    setContent("Vajutasid "+e.latlng.toString()).openOn(kaart);
                fetch(
                    "https://script.google.com/macros/s/AKfycbzkTI10bu1ixAovHR4P7GvJVJ8nkOdMbM3-VVIHE0IMCdEqLaut7F2DIXgqZ3tLdlW0qg/exec?pealkiri=" + pealkiri + "&laiuskraad=" + e.latlng.lat + "&pikkuskraad=" + e.latlng.lng
                ).then(d => d.text()).then(console.log);
            }
        </script>
    </head>
    <body onload="algus()">
        <div id="kaardikiht" name="kaardikiht">
            <input type="text" id="pealkiri" name="pealkiri">
        </div>
    </body>
</html>